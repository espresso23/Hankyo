<!-- Phần CSS (thêm vào phần style trong quizlet.jsp) -->
<style>
    /* Input modes display */
    .manual-input, .individual-input {
        display: none;
    }

    .manual-input.active, .individual-input.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }
</style>

<!-- Phần HTML (thay thế toàn bộ phần tab "Add") -->
<div class="tab-content" id="add">
    <div class="add-flashcard-form">
        <h2>Thêm Thẻ Ghi Nhớ Mới</h2>

        <c:if test="${not empty successMessages}">
            <div class="alert alert-success">
                <p><i class="fas fa-check-circle"></i> Thành công:</p>
                <ul>
                    <c:forEach var="msg" items="${successMessages}">
                        <li>${msg}</li>
                    </c:forEach>
                </ul>
            </div>
        </c:if>

        <c:if test="${not empty errorMessages}">
            <div class="alert alert-danger">
                <p><i class="fas fa-exclamation-circle"></i> Lỗi:</p>
                <ul>
                    <c:forEach var="msg" items="${errorMessages}">
                        <li>${msg}</li>
                    </c:forEach>
                </ul>
            </div>
        </c:if>

        <div class="input-mode-toggle">
            <button type="button" class="input-mode-btn active" data-mode="manual">
                <i class="fas fa-bolt"></i> Nhập Nhanh
            </button>
            <button type="button" class="input-mode-btn" data-mode="individual">
                <i class="fas fa-keyboard"></i> Nhập Đơn Lẻ
            </button>
        </div>

        <form id="flashcardForm" method="post" action="${pageContext.request.contextPath}/addFlashCard">
            <input type="hidden" id="mode" name="mode" value="manual">

            <div class="manual-input active">
                <div class="form-group">
                    <label for="manualTopic"><i class="fas fa-tag"></i> Chủ Đề</label>
                    <input type="text" id="manualTopic" name="manualTopic" class="form-control" placeholder="Nhập tên chủ đề" required>
                </div>
                <div class="form-group">
                    <label for="manualFlashCards"><i class="fas fa-list"></i> Thẻ Ghi Nhớ (cặp từ:nghĩa)</label>
                    <textarea id="manualFlashCards" name="manualFlashCards" class="form-control" placeholder="Nhập theo định dạng từ:nghĩa, ngăn cách bằng dấu chấm phẩy (;). Ví dụ: hello:xin chào;good:tốt" required></textarea>
                </div>
            </div>

            <div class="individual-input">
                <div class="form-group">
                    <label for="individualTopic"><i class="fas fa-tag"></i> Chủ Đề</label>
                    <input type="text" id="individualTopic" name="individualTopic" class="form-control" placeholder="Nhập tên chủ đề" required>
                </div>
                <div class="form-group">
                    <label for="word"><i class="fas fa-font"></i> Từ</label>
                    <input type="text" id="word" name="word" class="form-control" placeholder="Nhập từ mới" required>
                </div>
                <div class="form-group">
                    <label for="mean"><i class="fas fa-comment"></i> Nghĩa</label>
                    <input type="text" id="mean" name="mean" class="form-control" placeholder="Nhập nghĩa của từ" required>
                </div>
            </div>

            <button type="submit" class="btn btn-block">
                <i class="fas fa-plus-circle"></i> Thêm Thẻ Ghi Nhớ
            </button>
        </form>

        <div style="margin-top:20px;font-size:14px;color:#666;text-align:center;">
            <p><i class="fas fa-info-circle"></i> Đối với nhập nhanh, ngăn cách nhiều thẻ bằng dấu chấm phẩy (;) và định dạng mỗi cặp theo dạng "từ:nghĩa"</p>
        </div>
    </div>
</div>

<!-- Phần JavaScript (thay thế phần xử lý input mode toggle) -->
<script>
    // Xử lý chuyển đổi giữa các chế độ nhập
    document.addEventListener('DOMContentLoaded', function() {
        // Tab switching functionality (phần code hiện tại)
        
        // Input mode toggle mới
        const modeBtns = document.querySelectorAll('.input-mode-btn');
        const manualInput = document.querySelector('.manual-input');
        const individualInput = document.querySelector('.individual-input');
        const modeField = document.getElementById('mode');

        modeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                modeBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const mode = btn.getAttribute('data-mode');
                modeField.value = mode;
                
                if (mode === 'manual') {
                    manualInput.classList.add('active');
                    individualInput.classList.remove('active');
                } else {
                    manualInput.classList.remove('active');
                    individualInput.classList.add('active');
                }
            });
        });

        // Form validation
        const flashcardForm = document.getElementById('flashcardForm');
        flashcardForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const activeMode = document.querySelector('.input-mode-btn.active').getAttribute('data-mode');
            let isValid = true;
            let errorMessage = '';
            
            if (activeMode === 'manual') {
                const topic = document.getElementById('manualTopic').value.trim();
                const flashcards = document.getElementById('manualFlashCards').value.trim();
                
                if (!topic) {
                    errorMessage += 'Chủ đề không được để trống.\n';
                    isValid = false;
                }
                
                if (!flashcards) {
                    errorMessage += 'Bạn chưa nhập từ vựng.\n';
                    isValid = false;
                } else if (!flashcards.includes(':')) {
                    errorMessage += 'Định dạng không hợp lệ. Sử dụng định dạng "từ:nghĩa" phân cách bằng dấu chấm phẩy.\n';
                    isValid = false;
                }
            } else {
                const topic = document.getElementById('individualTopic').value.trim();
                const word = document.getElementById('word').value.trim();
                const mean = document.getElementById('mean').value.trim();
                
                if (!topic) {
                    errorMessage += 'Chủ đề không được để trống.\n';
                    isValid = false;
                }
                
                if (!word) {
                    errorMessage += 'Từ không được để trống.\n';
                    isValid = false;
                }
                
                if (!mean) {
                    errorMessage += 'Nghĩa không được để trống.\n';
                    isValid = false;
                }
            }
            
            if (isValid) {
                // Submit form và xử lý phản hồi JSON
                const formData = new FormData(this);
                
                fetch(this.action, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    // Hiển thị thông báo kết quả
                    let messages = [];
                    
                    if (data.success) {
                        // Hiển thị thông báo thành công
                        const successList = document.createElement('div');
                        successList.className = 'alert alert-success';
                        successList.innerHTML = `<p><i class="fas fa-check-circle"></i> Đã thêm thành công:</p><ul>`;
                        
                        data.flashcards.forEach(card => {
                            successList.innerHTML += `<li>Từ vựng: ${card.word} - Nghĩa: ${card.mean}</li>`;
                        });
                        
                        successList.innerHTML += `</ul>`;
                        
                        // Xóa thông báo cũ và thêm thông báo mới
                        const existingAlerts = document.querySelectorAll('.add-flashcard-form .alert');
                        existingAlerts.forEach(alert => alert.remove());
                        
                        document.querySelector('.add-flashcard-form h2').insertAdjacentElement('afterend', successList);
                        
                        // Reset form
                        if (activeMode === 'manual') {
                            document.getElementById('manualFlashCards').value = '';
                        } else {
                            document.getElementById('word').value = '';
                            document.getElementById('mean').value = '';
                        }
                    }
                    
                    // Hiển thị lỗi nếu có
                    if (data.errorMessages && data.errorMessages.length > 0) {
                        const errorList = document.createElement('div');
                        errorList.className = 'alert alert-danger';
                        errorList.innerHTML = `<p><i class="fas fa-exclamation-circle"></i> Lỗi:</p><ul>`;
                        
                        data.errorMessages.forEach(msg => {
                            errorList.innerHTML += `<li>${msg}</li>`;
                        });
                        
                        errorList.innerHTML += `</ul>`;
                        
                        // Thêm thông báo lỗi vào DOM
                        if (!document.querySelector('.add-flashcard-form .alert-danger')) {
                            document.querySelector('.add-flashcard-form h2').insertAdjacentElement('afterend', errorList);
                        }
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Đã xảy ra lỗi khi gửi dữ liệu. Vui lòng thử lại sau.');
                });
            } else {
                alert(errorMessage);
            }
        });
    });
</script> 